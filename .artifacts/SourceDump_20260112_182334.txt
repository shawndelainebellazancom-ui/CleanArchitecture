==============================================================================
PROJECT TOPOLOGY (Tree)
==============================================================================
‚îî‚îÄ‚îÄ üìÅ .template.config/
        üìÑ template.json
‚îî‚îÄ‚îÄ üìÅ artifacts/
‚îî‚îÄ‚îÄ üìÅ memory_trail/
‚îî‚îÄ‚îÄ üìÅ scripts/
‚îî‚îÄ‚îÄ üìÅ src/
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.AppHost/
        ‚îî‚îÄ‚îÄ üìÅ Properties/
                üìÑ launchSettings.json
            üìÑ AppHost.cs
            üìÑ appsettings.Development.json
            üìÑ appsettings.json
            üìÑ ProjectName.AppHost.csproj
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.Application/
            üìÑ Orchestrator.cs
            üìÑ ProjectName.Application.csproj
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.Core/
        ‚îî‚îÄ‚îÄ üìÅ Entities/
                üìÑ AgentIdentity.cs
                üìÑ Thought.cs
        ‚îî‚îÄ‚îÄ üìÅ Interfaces/
                üìÑ ICognitiveTrail.cs
                üìÑ IPlanner.cs
            üìÑ ProjectName.Core.csproj
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.Infrastructure/
        ‚îî‚îÄ‚îÄ üìÅ Schemas/
                üìÑ Plan.schema.json
            üìÑ Class1.cs
            üìÑ DefaultPlanner.cs
            üìÑ ProjectName.Infrastructure.csproj
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.OrchestrationApi/
        ‚îî‚îÄ‚îÄ üìÅ Controllers/
                üìÑ WeatherForecastController.cs
        ‚îî‚îÄ‚îÄ üìÅ Properties/
                üìÑ launchSettings.json
            üìÑ appsettings.Development.json
            üìÑ appsettings.json
            üìÑ Dockerfile
            üìÑ Program.cs
            üìÑ ProjectName.OrchestrationApi.csproj
            üìÑ WeatherForecast.cs
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.PlanerService/
        ‚îî‚îÄ‚îÄ üìÅ Properties/
                üìÑ launchSettings.json
        ‚îî‚îÄ‚îÄ üìÅ Protos/
        ‚îî‚îÄ‚îÄ üìÅ Services/
                üìÑ PlannerGrpcService.cs
            üìÑ appsettings.Development.json
            üìÑ appsettings.json
            üìÑ Dockerfile
            üìÑ Program.cs
            üìÑ ProjectName.PlanerService.csproj
    ‚îî‚îÄ‚îÄ üìÅ ProjectName.ServiceDefaults/
            üìÑ Extensions.cs
            üìÑ ProjectName.ServiceDefaults.csproj
    üìÑ nuget.config

==============================================================================
SOURCE CODE INGESTION
==============================================================================
------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\.template.config
------------------------------------------------------------------------------


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\.template.config\template.json
------------------------------------------------------------------------------
{
  "$schema": "http://json.schemastore.org/template",
  "author": "Shawn Delaine Bellazan / Tooensure LLC",
  "identity": "Tooensure.Agent.GodSeed",
  "name": "Sovereign Agent Factory (PMCR-O)",
  "shortName": "agent-seed",
  "sourceName": "ProjectName",
  "preferNameDirectory": true,
  "symbols": {
    "ProjectName": {
      "type": "parameter",
      "replaces": "ProjectName",
      "description": "The explicit name of the Agent Project."
    }
  }
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.AppHost\Properties\launchSettings.json
------------------------------------------------------------------------------
{
  "$schema": "https://json.schemastore.org/launchsettings.json",
  "profiles": {
    "https": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "applicationUrl": "https://projectname_apphost.dev.localhost:17085;http://projectname_apphost.dev.localhost:15239",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development",
        "DOTNET_ENVIRONMENT": "Development",
        "ASPIRE_DASHBOARD_OTLP_ENDPOINT_URL": "https://localhost:21288",
        "ASPIRE_DASHBOARD_MCP_ENDPOINT_URL": "https://localhost:23261",
        "ASPIRE_RESOURCE_SERVICE_ENDPOINT_URL": "https://localhost:22042"
      }
    },
    "http": {
      "commandName": "Project",
      "dotnetRunMessages": true,
      "launchBrowser": true,
      "applicationUrl": "http://projectname_apphost.dev.localhost:15239",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development",
        "DOTNET_ENVIRONMENT": "Development",
        "ASPIRE_DASHBOARD_OTLP_ENDPOINT_URL": "http://localhost:19299",
        "ASPIRE_DASHBOARD_MCP_ENDPOINT_URL": "http://localhost:18282",
        "ASPIRE_RESOURCE_SERVICE_ENDPOINT_URL": "http://localhost:20266"
      }
    }
  }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.AppHost\AppHost.cs
------------------------------------------------------------------------------
var builder = DistributedApplication.CreateBuilder(args);

builder.Build().Run();


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.AppHost\appsettings.Development.json
------------------------------------------------------------------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.AppHost\appsettings.json
------------------------------------------------------------------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Aspire.Hosting.Dcp": "Warning"
    }
  }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.AppHost\ProjectName.AppHost.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<TargetFramework>net10.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
		<!-- Suppress warnings for SDK package references when using CPM -->
		<NoWarn>$(NoWarn);NU1507;NU1605</NoWarn>
	</PropertyGroup>

	<ItemGroup>
		<!-- Explicit package references required for AppHost -->
		<PackageReference Include="Aspire.Hosting.AppHost" />
		<PackageReference Include="Aspire.Hosting.Python" />
	</ItemGroup>

	<ItemGroup>
		<ProjectReference Include="..\ProjectName.ServiceDefaults\ProjectName.ServiceDefaults.csproj" />
	</ItemGroup>

</Project>

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Application\Orchestrator.cs
------------------------------------------------------------------------------
using ProjectName.Core;
using ProjectName.Core.Entities;
using ProjectName.Core.Interfaces;

namespace ProjectName.Application;

public class CognitiveOrchestrator(IPlanner planner, ICognitiveTrail trail, AgentIdentity identity)
{
    //public async Task<string> ProcessIntent(string seed)
    //{
    //    // Phase P: Plan
    //    //var plan = await planner.PlanBareMinimum(seed);
    //    //trail.Record("Plan", new { Seed = seed, Result = plan });

    //    //return $"[IDENTITY: {identity.Name}] I have processed your intent. Plan: {plan}";
    //}
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Application\ProjectName.Application.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net10.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
	</PropertyGroup>

	<ItemGroup>
		<ProjectReference Include="..\ProjectName.Core\ProjectName.Core.csproj" />
	</ItemGroup>

</Project>

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Core\Entities\AgentIdentity.cs
------------------------------------------------------------------------------
namespace ProjectName.Core.Entities;

public record AgentIdentity(string Name, string Role, string Philosophy);

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Core\Entities\Thought.cs
------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Text;

namespace ProjectName.Core.Entities
{
    public record Thought(string Phase, string Content, DateTime Timestamp);

}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Core\Interfaces\ICognitiveTrail.cs
------------------------------------------------------------------------------
using System;
using System.Collections.Generic;
using System.Text;

namespace ProjectName.Core.Interfaces
{
    public interface ICognitiveTrail
    {
        void Record(string phase, object data);
        string GetHistory();
    }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Core\Interfaces\IPlanner.cs
------------------------------------------------------------------------------
namespace ProjectName.Core.Interfaces;

/// <summary>
/// Represents a single step in an execution plan
/// </summary>
public sealed record PlanStep(
    int Order,
    string Action,
    string Tool,
    string ArgumentsJson = "{}");

/// <summary>
/// Represents the complete plan with analysis and steps
/// </summary>
public sealed record PlanResult(
    string Goal,
    List<PlanStep> Steps,
    string Analysis);

/// <summary>
/// Planning interface for PMCR-O Phase P (Plan)
/// </summary>
public interface IPlanner
{
    /// <summary>
    /// Creates a structured plan from user intent using LLM reasoning
    /// </summary>
    Task<PlanResult> CreatePlanAsync(string intent, CancellationToken ct = default);
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Core\ProjectName.Core.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net10.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
	</PropertyGroup>

	<ItemGroup>
		<PackageReference Include="Microsoft.Extensions.AI.Abstractions" />
	</ItemGroup>

</Project>

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Infrastructure\Schemas\Plan.schema.json
------------------------------------------------------------------------------
{
  "type": "object",
  "required": [ "Goal", "Steps" ],
  "properties": {
    "Goal": { "type": "string" },
    "Steps": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [ "Order", "Action", "Tool", "ArgumentsJson" ],
        "properties": {
          "Order": { "type": "integer" },
          "Action": { "type": "string" },
          "Tool": { "type": "string" },
          "ArgumentsJson": { "type": "string" }
        }
      }
    }
  }
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Infrastructure\Class1.cs
------------------------------------------------------------------------------
namespace ProjectName.Infrastructure
{
    public class Class1
    {

    }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Infrastructure\DefaultPlanner.cs
------------------------------------------------------------------------------
using System.Text.Json;
using ProjectName.Core.Interfaces;

namespace ProjectName.Infrastructure;

public class DefaultPlanner : IPlanner
{
    public Task<PlanResult> CreatePlanAsync(string intent, CancellationToken ct = default)
    {
        throw new NotImplementedException();
    }

    public Task<string> PlanBareMinimum(string seedIntent)
    {
        var plan = new
        {
            Steps = new[] { "Analyze Input", "Generate Artifact", "Reflect" },
            Target = seedIntent
        };
        return Task.FromResult(JsonSerializer.Serialize(plan));
    }
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.Infrastructure\ProjectName.Infrastructure.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net10.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
	</PropertyGroup>

	<ItemGroup>
		<PackageReference Include="ModelContextProtocol" />
		<PackageReference Include="Microsoft.Extensions.AI" />
	</ItemGroup>

	<ItemGroup>
		<ProjectReference Include="..\ProjectName.Core\ProjectName.Core.csproj" />
	</ItemGroup>

</Project>

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\Controllers\WeatherForecastController.cs
------------------------------------------------------------------------------
using Microsoft.AspNetCore.Mvc;

namespace ProjectName.OrchestrationApi.Controllers
{
    [ApiController]
    [Route("[controller]")]
    public class WeatherForecastController : ControllerBase
    {
        private static readonly string[] Summaries =
        [
            "Freezing", "Bracing", "Chilly", "Cool", "Mild", "Warm", "Balmy", "Hot", "Sweltering", "Scorching"
        ];

        [HttpGet(Name = "GetWeatherForecast")]
        public IEnumerable<WeatherForecast> Get()
        {
            return Enumerable.Range(1, 5).Select(index => new WeatherForecast
            {
                Date = DateOnly.FromDateTime(DateTime.Now.AddDays(index)),
                TemperatureC = Random.Shared.Next(-20, 55),
                Summary = Summaries[Random.Shared.Next(Summaries.Length)]
            })
            .ToArray();
        }
    }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\Properties\launchSettings.json
------------------------------------------------------------------------------
{
  "profiles": {
    "http": {
      "commandName": "Project",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      },
      "dotnetRunMessages": true,
      "applicationUrl": "http://localhost:5234"
    },
    "https": {
      "commandName": "Project",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      },
      "dotnetRunMessages": true,
      "applicationUrl": "https://localhost:7269;http://localhost:5234"
    },
    "Container (Dockerfile)": {
      "commandName": "Docker",
      "launchUrl": "{Scheme}://{ServiceHost}:{ServicePort}",
      "environmentVariables": {
        "ASPNETCORE_HTTPS_PORTS": "8081",
        "ASPNETCORE_HTTP_PORTS": "8080"
      },
      "publishAllPorts": true,
      "useSSL": true
    }
  },
  "$schema": "https://json.schemastore.org/launchsettings.json"
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\appsettings.Development.json
------------------------------------------------------------------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\appsettings.json
------------------------------------------------------------------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*"
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\Dockerfile
------------------------------------------------------------------------------
# See https://aka.ms/customizecontainer to learn how to customize your debug container and how Visual Studio uses this Dockerfile to build your images for faster debugging.

# This stage is used when running from VS in fast mode (Default for Debug configuration)
FROM mcr.microsoft.com/dotnet/aspnet:10.0 AS base
USER $APP_UID
WORKDIR /app
EXPOSE 8080
EXPOSE 8081


# This stage is used to build the service project
FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
ARG BUILD_CONFIGURATION=Release
WORKDIR /src
COPY ["Directory.Packages.props", "."]
COPY ["Directory.Build.props", "."]
COPY ["Directory.Build.targets", "."]
COPY ["nuget.config", "."]
COPY ["src/ProjectName.OrchestrationApi/ProjectName.OrchestrationApi.csproj", "src/ProjectName.OrchestrationApi/"]
RUN dotnet restore "./src/ProjectName.OrchestrationApi/ProjectName.OrchestrationApi.csproj"
COPY . .
WORKDIR "/src/src/ProjectName.OrchestrationApi"
RUN dotnet build "./ProjectName.OrchestrationApi.csproj" -c $BUILD_CONFIGURATION -o /app/build

# This stage is used to publish the service project to be copied to the final stage
FROM build AS publish
ARG BUILD_CONFIGURATION=Release
RUN dotnet publish "./ProjectName.OrchestrationApi.csproj" -c $BUILD_CONFIGURATION -o /app/publish /p:UseAppHost=false

# This stage is used in production or when running from VS in regular mode (Default when not using the Debug configuration)
FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "ProjectName.OrchestrationApi.dll"]

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\Program.cs
------------------------------------------------------------------------------
var builder = WebApplication.CreateBuilder(args);

// Add services to the container.

builder.Services.AddControllers();
// Learn more about configuring OpenAPI at https://aka.ms/aspnet/openapi
//builder.Services.AddOpenApi();

var app = builder.Build();

// Configure the HTTP request pipeline.
if (app.Environment.IsDevelopment())
{
    //app.MapOpenApi();
}

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\ProjectName.OrchestrationApi.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk.Web">

	<PropertyGroup>
		<TargetFramework>net10.0</TargetFramework>
		<Nullable>enable</Nullable>
		<ImplicitUsings>enable</ImplicitUsings>
		<UserSecretsId>3d7bd789-e3a4-4c4d-bc2c-8aae42e708f6</UserSecretsId>
		<DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
		<DockerfileContext>..\..</DockerfileContext>
	</PropertyGroup>

	<ItemGroup>
		<Protobuf Include="..\ProjectName.PlanerService\Protos\planner.proto" GrpcServices="Client" />
	</ItemGroup>

	<ItemGroup>
		
		<PackageReference Include="Microsoft.AspNetCore.OpenApi" />
		<PackageReference Include="Microsoft.VisualStudio.Azure.Containers.Tools.Targets" />
		<PackageReference Include="Swashbuckle.AspNetCore" Version="7.2.0" />
	</ItemGroup>

</Project>

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.OrchestrationApi\WeatherForecast.cs
------------------------------------------------------------------------------
namespace ProjectName.OrchestrationApi
{
    public class WeatherForecast
    {
        public DateOnly Date { get; set; }

        public int TemperatureC { get; set; }

        public int TemperatureF => 32 + (int)(TemperatureC / 0.5556);

        public string? Summary { get; set; }
    }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\Properties\launchSettings.json
------------------------------------------------------------------------------
{
  "profiles": {
    "http": {
      "commandName": "Project",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      },
      "dotnetRunMessages": true,
      "applicationUrl": "http://localhost:5138"
    },
    "https": {
      "commandName": "Project",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      },
      "dotnetRunMessages": true,
      "applicationUrl": "https://localhost:7035;http://localhost:5138"
    },
    "Container (Dockerfile)": {
      "commandName": "Docker",
      "launchUrl": "{Scheme}://{ServiceHost}:{ServicePort}",
      "environmentVariables": {
        "ASPNETCORE_HTTPS_PORTS": "8081",
        "ASPNETCORE_HTTP_PORTS": "8080"
      },
      "publishAllPorts": true,
      "useSSL": true
    }
  },
  "$schema": "https://json.schemastore.org/launchsettings.json"
}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\Services\PlannerGrpcService.cs
------------------------------------------------------------------------------
//using ProjectName.Core.Interfaces;
//using ProjectName.PlanerService.Protos;
//using System.Numerics;

//namespace ProjectName.PlanerService.Services;

///// <summary>
///// gRPC service implementing the Planner interface
///// This is the infrastructure node that handles planning logic
///// </summary>
//public class PlannerGrpcService : Planner.PlannerBase
//{
//    private readonly IPlanner _planner;
//    private readonly ILogger<PlannerGrpcService> _logger;

//    public PlannerGrpcService(IPlanner planner, ILogger<PlannerGrpcService> logger)
//    {
//        _planner = planner;
//        _logger = logger;
//    }

//    public override async Task<PlanResponse> CreatePlan(PlanRequest request, ServerCallContext context)
//    {
//        _logger.LogInformation("CreatePlan called with intent: {Intent}", request.Intent);

//        try
//        {
//            var plan = await _planner.CreatePlanAsync(request.Intent, context.CancellationToken);

//            var response = new PlanResponse
//            {
//                Goal = plan.Goal,
//                Analysis = plan.Analysis,
//                Success = true
//            };

//            foreach (var step in plan.Steps)
//            {
//                response.Steps.Add(new PlanStepMessage
//                {
//                    Order = step.Order,
//                    Action = step.Action,
//                    Tool = step.Tool,
//                    ArgumentsJson = step.ArgumentsJson
//                });
//            }

//            return response;
//        }
//        catch (Exception ex)
//        {
//            _logger.LogError(ex, "Error creating plan");
//            return new PlanResponse
//            {
//                Success = false,
//                ErrorMessage = ex.Message
//            };
//        }
//    }
//}

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\appsettings.Development.json
------------------------------------------------------------------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\appsettings.json
------------------------------------------------------------------------------
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "Kestrel": {
    "EndpointDefaults": {
      "Protocols": "Http2"
    }
  }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\Dockerfile
------------------------------------------------------------------------------
# See https://aka.ms/customizecontainer to learn how to customize your debug container and how Visual Studio uses this Dockerfile to build your images for faster debugging.

# This stage is used when running from VS in fast mode (Default for Debug configuration)
FROM mcr.microsoft.com/dotnet/aspnet:10.0 AS base
USER $APP_UID
WORKDIR /app
EXPOSE 8080
EXPOSE 8081


# This stage is used to build the service project
FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
ARG BUILD_CONFIGURATION=Release
WORKDIR /src
COPY ["Directory.Packages.props", "."]
COPY ["Directory.Build.props", "."]
COPY ["Directory.Build.targets", "."]
COPY ["nuget.config", "."]
COPY ["src/ProjectName.PlanerService/ProjectName.PlanerService.csproj", "src/ProjectName.PlanerService/"]
RUN dotnet restore "./src/ProjectName.PlanerService/ProjectName.PlanerService.csproj"
COPY . .
WORKDIR "/src/src/ProjectName.PlanerService"
RUN dotnet build "./ProjectName.PlanerService.csproj" -c $BUILD_CONFIGURATION -o /app/build

# This stage is used to publish the service project to be copied to the final stage
FROM build AS publish
ARG BUILD_CONFIGURATION=Release
RUN dotnet publish "./ProjectName.PlanerService.csproj" -c $BUILD_CONFIGURATION -o /app/publish /p:UseAppHost=false

# This stage is used in production or when running from VS in regular mode (Default when not using the Debug configuration)
FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "ProjectName.PlanerService.dll"]

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\Program.cs
------------------------------------------------------------------------------

var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
builder.Services.AddGrpc();

var app = builder.Build();

// Configure the HTTP request pipeline.
//app.MapGrpcService<GreeterService>();
app.MapGet("/", () => "Communication with gRPC endpoints must be made through a gRPC client. To learn how to create a client, visit: https://go.microsoft.com/fwlink/?linkid=2086909");

app.Run();


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.PlanerService\ProjectName.PlanerService.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
    <UserSecretsId>96d01d32-0ed9-4755-a32e-d303666266ce</UserSecretsId>
    <DockerDefaultTargetOS>Linux</DockerDefaultTargetOS>
    <DockerfileContext>..\..</DockerfileContext>
  </PropertyGroup>

  <ItemGroup>
    <Protobuf Include="Protos\planner.proto" GrpcServices="Server" />
  </ItemGroup>

  <ItemGroup>
    <PackageReference Include="Grpc.AspNetCore"  />
    <PackageReference Include="Microsoft.VisualStudio.Azure.Containers.Tools.Targets" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\ProjectName.Core\ProjectName.Core.csproj" />
  </ItemGroup>

</Project>


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.ServiceDefaults\Extensions.cs
------------------------------------------------------------------------------
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Diagnostics.HealthChecks;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Diagnostics.HealthChecks;
using Microsoft.Extensions.Logging;
using Microsoft.Extensions.ServiceDiscovery;
using OpenTelemetry;
using OpenTelemetry.Metrics;
using OpenTelemetry.Trace;

namespace Microsoft.Extensions.Hosting
{
    // Adds common Aspire services: service discovery, resilience, health checks, and OpenTelemetry.
    // This project should be referenced by each service project in your solution.
    // To learn more about using this project, see https://aka.ms/dotnet/aspire/service-defaults
    public static class Extensions
    {
        private const string HealthEndpointPath = "/health";
        private const string AlivenessEndpointPath = "/alive";

        public static TBuilder AddServiceDefaults<TBuilder>(this TBuilder builder) where TBuilder : IHostApplicationBuilder
        {
            builder.ConfigureOpenTelemetry();

            builder.AddDefaultHealthChecks();

            builder.Services.AddServiceDiscovery();

            builder.Services.ConfigureHttpClientDefaults(http =>
            {
                // Turn on resilience by default
                http.AddStandardResilienceHandler();

                // Turn on service discovery by default
                http.AddServiceDiscovery();
            });

            // Uncomment the following to restrict the allowed schemes for service discovery.
            // builder.Services.Configure<ServiceDiscoveryOptions>(options =>
            // {
            //     options.AllowedSchemes = ["https"];
            // });

            return builder;
        }

        public static TBuilder ConfigureOpenTelemetry<TBuilder>(this TBuilder builder) where TBuilder : IHostApplicationBuilder
        {
            builder.Logging.AddOpenTelemetry(logging =>
            {
                logging.IncludeFormattedMessage = true;
                logging.IncludeScopes = true;
            });

            builder.Services.AddOpenTelemetry()
                .WithMetrics(metrics =>
                {
                    metrics.AddAspNetCoreInstrumentation()
                        .AddHttpClientInstrumentation()
                        .AddRuntimeInstrumentation();
                })
                .WithTracing(tracing =>
                {
                    tracing.AddSource(builder.Environment.ApplicationName)
                        .AddAspNetCoreInstrumentation(tracing =>
                            // Exclude health check requests from tracing
                            tracing.Filter = context =>
                                !context.Request.Path.StartsWithSegments(HealthEndpointPath)
                                && !context.Request.Path.StartsWithSegments(AlivenessEndpointPath)
                        )
                        // Uncomment the following line to enable gRPC instrumentation (requires the OpenTelemetry.Instrumentation.GrpcNetClient package)
                        //.AddGrpcClientInstrumentation()
                        .AddHttpClientInstrumentation();
                });

            builder.AddOpenTelemetryExporters();

            return builder;
        }

        private static TBuilder AddOpenTelemetryExporters<TBuilder>(this TBuilder builder) where TBuilder : IHostApplicationBuilder
        {
            var useOtlpExporter = !string.IsNullOrWhiteSpace(builder.Configuration["OTEL_EXPORTER_OTLP_ENDPOINT"]);

            if (useOtlpExporter)
            {
                builder.Services.AddOpenTelemetry().UseOtlpExporter();
            }

            // Uncomment the following lines to enable the Azure Monitor exporter (requires the Azure.Monitor.OpenTelemetry.AspNetCore package)
            //if (!string.IsNullOrEmpty(builder.Configuration["APPLICATIONINSIGHTS_CONNECTION_STRING"]))
            //{
            //    builder.Services.AddOpenTelemetry()
            //       .UseAzureMonitor();
            //}

            return builder;
        }

        public static TBuilder AddDefaultHealthChecks<TBuilder>(this TBuilder builder) where TBuilder : IHostApplicationBuilder
        {
            builder.Services.AddHealthChecks()
                // Add a default liveness check to ensure app is responsive
                .AddCheck("self", () => HealthCheckResult.Healthy(), ["live"]);

            return builder;
        }

        public static WebApplication MapDefaultEndpoints(this WebApplication app)
        {
            // Adding health checks endpoints to applications in non-development environments has security implications.
            // See https://aka.ms/dotnet/aspire/healthchecks for details before enabling these endpoints in non-development environments.
            if (app.Environment.IsDevelopment())
            {
                // All health checks must pass for app to be considered ready to accept traffic after starting
                app.MapHealthChecks(HealthEndpointPath);

                // Only health checks tagged with the "live" tag must pass for app to be considered alive
                app.MapHealthChecks(AlivenessEndpointPath, new HealthCheckOptions
                {
                    Predicate = r => r.Tags.Contains("live")
                });
            }

            return app;
        }
    }
}


------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\src\ProjectName.ServiceDefaults\ProjectName.ServiceDefaults.csproj
------------------------------------------------------------------------------
<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<TargetFramework>net10.0</TargetFramework>
		<ImplicitUsings>enable</ImplicitUsings>
		<Nullable>enable</Nullable>
		<IsAspireSharedProject>true</IsAspireSharedProject>
	</PropertyGroup>

	<ItemGroup>
		<FrameworkReference Include="Microsoft.AspNetCore.App" />

		<!-- NO VERSION ATTRIBUTES - All versions from Directory.Packages.props -->
		<PackageReference Include="Microsoft.Extensions.Http.Resilience" />
		<PackageReference Include="Microsoft.Extensions.ServiceDiscovery" />
		<PackageReference Include="OpenTelemetry.Exporter.OpenTelemetryProtocol" />
		<PackageReference Include="OpenTelemetry.Extensions.Hosting" />
		<PackageReference Include="OpenTelemetry.Instrumentation.AspNetCore" />
		<PackageReference Include="OpenTelemetry.Instrumentation.Http" />
		<PackageReference Include="OpenTelemetry.Instrumentation.Runtime" />
	</ItemGroup>

</Project>

------------------------------------------------------------------------------
FILE: T:\agents\ProjectName\nuget.config
------------------------------------------------------------------------------
<?xml version="1.0" encoding="utf-8"?>
<configuration>
	<packageSources>
		<clear />
		<add key="nuget.org" value="https://api.nuget.org/v3/index.json" />
		<add key="Telerik" value="https://nuget.telerik.com/v3/index.json" />
	</packageSources>
	<packageSourceMapping>
		<packageSource key="nuget.org">
			<package pattern="*" />
		</packageSource>
		<packageSource key="Telerik">
			<package pattern="Telerik.*" />
			<package pattern="Kendo.*" />
		</packageSource>
	</packageSourceMapping>
</configuration>


